---
layout: post
title: "ABTest测试结果不显著的思考"
date: 2021-06-18
description: "ABTest结果不显著的思考"
tag: 数据分析
katex: true
---

AB Test出现实验结果不显著主要有两方面原因 ：

- AB Test的变化确实没有效果，两组指标在事实上是相同的
- AB Test的变化有效果，两组指标在事实上是不同的。但由于变化程度很小，测试的灵敏度Power不足，所以没有检测到两组指标的不同

对于第一种原因，我们可以放弃这个变化，但需要记录相关的实验文档

对于第二种原因，我们就要去做一定的优化和调整，也就是说去提高Power从而来提高AB Test 检测到实验结果不同的概率。Power 越大，越能够反映对照组和实验组之间的不同。

由[样本量计算公式](https://pangzhengyang.github.io/2021/05/abtest-sample-size/) :
$$
N = \frac{(z_{1-\frac{\alpha}{2}}+z_{power})^2 \ \sigma^2}{\delta^2} \\
\sigma -样本标准差 \\
\delta -组间预期差值
$$
可得出影响Power 的因素 主要有两个：样本量和方差
$$
z_{power} = \frac{\sqrt N \delta}{\sigma} - z_{1-{\frac{\alpha}{2}}}
$$

- Power 和样本量成正比
- Power 和方差成反比

## 通过增加样本量来提高Power

三种常用方法：**延长测试时间、增加测试使用流量在总流量中的占比、多个测试共用同一个对照组**

### 延长测试时间

每天产生的可以测试的流量是固定的，那么测试时间越长 ，样本量越大

### 增加测试使用流量咋总流量中的占比

做AB Test基本不会直接上来就切100%的流量，一般会用总流量中的一部分，原因有几点：

1. 某个改动可能对业务造成损害，造成公司损失
2. 对于互联网巨头来说，本身拥有很多流量，产品做成任何明显变化都可能变成新闻被别人关注

那么之前如果只用了总流量的10%来测试，那么现在可以加大流量。

### 多个测试共用一个对照组

有时候我们会在同一个产品上同时跑多个AB Test，比如我们想要提升推送的点击率，就会在原推送的基础上改变推送的标题、推送的内容、推送的时间、推送的受众，等等。

对于这四个不同的影响因素，事实上，改变每一个因素都是一个独立的 A/B 测试。那理论上我们就需要设计 4 个实验，需要有 4 个实验组和 4 个对照组。

假设我们现在的可用流量一共是 8 万，那么每组就有 1 万流量。但是你会发现这样流量的利用率太低了，因为每个实验的对照组其实都是一样的（原推送）。但如果我们把 4 个对照组合并成一个，这样的话就变成了 4 个实验组和 1 个对照组，每组就有 1.6 万流量。

在同一个基础上想同时验证多个变化，也就是跑多个 A/B 测试有相同的对照组的时候，我们可以把对照组合并，减少分组数量，这样每组的样本量也会增加。这种测试又叫做 A/B/n 测试。

## 通过减小方差来提高Power

三种常用方法：**减少指标的方差、倾向评分匹配、在触发阶段计算指标**

### 减少指标的方差

1. 保持原指标不变，剔除离群值

2. 选用方差较小的指标

   取值范围窄的指标比取值范围宽的指标方差小。

   对于买买买、听音乐、看视频这些行为，概率类指标比均值类指标的方差小

### 倾向评分匹配

倾向评分匹配（Propensity Score Matching）是因果推断的一种方法，目的是解决试验组和对照组分布不均的问题。

这一块还未使用过且没有学习相关原理，暂时不讲这一块，待后续补充。

### 在触发阶段计算指标

分配：在AB Test中把随机单位进行随机分组的这个过程

有些时候，测试的变化需要出发一定条件才会显现 ，所以从分配和触发的关系上来看，AB Test分为两种

1. 变化不需要条件触发。所有用户被分配到实验组的时候，就可以体验到变化；
2. 变化需要条件触发。在被分配到实验组的用户当中，只有触发了一定条件，才能体验到AB Test的变化。

![2021-06-18-abtest-not-significant-1](\assets\2021-06-18-abtest-not-significant-1.png)

对于减少方差，适用于第二种AB Test。就是在计算指标时只考虑每组符合触发条件（黄圆圈）的用户，而不是考虑每组中的所有用户（绿圆圈）

## 总结

![2021-06-18-abtest-not-significant-2](\assets\2021-06-18-abtest-not-significant-2.png)

