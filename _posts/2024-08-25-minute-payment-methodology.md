---
layout: post
title: "支付方法论"
date: 2024-08-25
description: "支付方法论"
tag: 读书笔记
katex: true  
---

支付是社会经济活动所引起的货币债权的转移过程，包括三个基本过程：交易、清分和结算。这三个基本过程被称为支付的三原基。交易是支付的前提，清分是结算前的数据准备，结算是资金流的实际划拨。

# 中国现代支付体系

现代支付体系的主要构成包括支付服务组织、支付系统、支付工具、支付体系监管四个部分。

![中国现代支付体系](\assets\reading minutes\2024-08-25-minute-payment-methodology\1.png)

## 支付服务组织

- 央行：（银行间）为银行间资金转移提供服务，处理商业银行等金融机构之间的资金往来和债务关系，为其办理转账结算和清算服务。制定各种制度。

- 银行业金融机构：（个人或企业对银行）作为发卡行提供支付介质（如各类银行卡），提供各类支付工具及产品（如网银、ATM、POS等）。

- 支付清算组织：为支付主体提供支付信息交换，数据清分和汇总等功能。比如银联，负责发卡机构和收单机构间的交易处理。

## 支付系统

支付系统支撑资金转移。包括大额实时支付系统、小额批量支付系统、网上支付跨行清算系统（超级网银系统）、境内外支付系统等。

- 大额实时支付系统（High Value Payment System，HVPS）用于处理银行之间或者金融市场参与主体间较大金额贷记业务、紧急小额贷记支付业务、即时转账业务。

- 小额批量支付系统（Bulk Electronic Payment System，BEPS）主要用于处理金额较小和紧急程度较低的交易。由于系统设定且多笔交易等待打包批次需要时间，所以小额批量支付系统具有一定延时性。

- 网上支付跨行清算系统（Internet Banking Payment System， IBPS）又称超级网银系统。具备跨行实时转账、跨行查询、跨行资金归集、统一数据格式等功能。

  **支持第三方持牌公司接入系统**，支持跨行转账查询及资金归集；

  **可7×24小时实时发起**、实时到账（大小额系统在非工作日非营 业时间均无法处理资金实时到账）。
  
- 境内外币支付系统（Foreign Currency Payment System，FCPS）境内外币支付系统是 为中国境内银行业金融机构及外币清算机构提供境内外币支付服务的 实时全额支付系统，并规定了代理结算银行和各自代理结算币种。

## 支付工具

现金支付和非现金支付。

非现金支付种类较多，有票据，比如汇票、本票、支票；有卡基支付，比如银行卡、预付卡；有网银支付，比如各类收银台；有账户支付，比如微信、支付宝等各类钱包账户。

## 支付体系监管

支付体系监管包括支付体系的法规制度和政府及行业的有效监督管理。

```
几个关键的概念：
1.收单：提供给商户的服务，受理用户各类支付工具并完成资金结算。
2.收单机构：可以是银行也可以是第三方机构（持有“银行卡收单”牌照。
3.chargeback：用户因为某些原因向发卡行申请拒绝支付某笔交易。发卡行会通过卡组织、收单机构向商户确认交易情况。
4.冲正在支付过程中，在一笔发起交易后，该笔交易需要上送到银联，银行各个渠道，在这个交易环节中可能有网络问题，导致交易没有正确返回结果，这时候，终端就会发送一个请求查询该笔交易的状态，如果这个交易已经上送到渠道方成功的话，则返回结果，如果这笔交易失败的话，则回滚（撤回）这笔交易。
```

# 支付通道结构

支付通道的结构包括支付方式、支付品牌、支付通道和支付产品。

## 支付方式

支付方式是指针对支付种类特性表现的一种归类，也是对自身内部支付产品的包装，即按外部商户的需求将支付产品打包成一种支付方式提供给外部商户。

常见的支付方式有信用卡支付、储蓄卡支付、网银支付、第三方支付。

## 支付品牌

支付品牌是指支付方式下的具体银行品牌或第三方支付品牌。支付方式下可以有多个支付品牌。

比如信用卡支付，这样的支付方式可以有工商银行信用卡、建设银行信用卡、交通银行信用卡等多个支付品牌。第三方支付方式包括微信支付、支付宝等多个支付品牌。

支付品牌由支付通道支持，支付品牌与支付通道是多对多关系。既可以多个支付通道支持同一个支付品牌，也可以一个支付通道支持多个支付品牌。

比如建行信用卡由建行直连通道、银联通道支持；银联通道除了支持建行信用卡，还支持农行信用卡、民生银行信用卡等支付品牌。

## 支付通道

支付通道是指支付品牌背后提供支付受理能力的具体提供方，比如工行直连通道、银联通道、连连支付等。

举个例子，你去超市买东西的时候看到的康师傅方便面是品牌，至于是江西的供货商还是江苏的供货商你并不知道，但商家知道，那些供应商就如同支付里的通道。

**不同通道有不同的特点。**

- 额度方面：有些通道支持大额交易（单笔10w、20w）有些只能到1w；
- 结算时效：有的实时结算、有的工作日第二天结算；
- 费率方面：按笔使用费、按百分比收费、固定费率；
- 拒付方面：有的拒付风险交易认定是不赔偿的，有的是包赔偿的；

对于支付通道，物理链路不可拆分的，称为物理通道；物理链路可以按照接入渠道、接入商户、不同品牌、实际用途、价格等因素拆分成不同配置规则的，称为逻辑通道。

## 支付产品

支付产品是指把通道根据不同特性与维度（比如渠道、功能、价格等）归类并包装成具有一定特性的商户产品，如信用卡快捷产品、信用卡MOTO产品、鉴权产品等。

```
支付方式与支付产品的区别，比如信用卡支付这样的支付方式，由于通道特性不一样，有了信用卡非免密支付产品和信用卡免密支付产品，两者虽然支持的支付方式都是信用卡，但却是两个不同的支付产品。
```

![支付方式-品牌-通道-产品](\assets\reading minutes\2024-08-25-minute-payment-methodology\2.png)



## 支付通道分类

### 按用途分类

- 出款通道：出钱，实现资产所有人支付款项给他人的通道。出款通道有代发（代付）类、转账类，主要应用于提现、发工资、退款等场景。
- 入款通道：收钱，实现他人把钱付给资产所有人的通道。入款通道有很多类型和形态，如代扣、MOTO、无磁无密、网银、快捷、转账、POS机支付、扫码支付、账户支付、近场支付。其应用场景很多，网上支付、扣款、信用卡代扣、水电煤代缴等都是。
- 鉴权通道：与支付无关，只验证信息是否正确的通道。卡信息验证、身份信息认证、OCR验证，比如账户的实名认证、银行卡的绑定等场景都需要用到鉴权通道。

### 按通道支持对象

- 对公支付
- 对私支付

### 按支持形态

- 卡基支付：以卡片作为支付工具、通过媒介提供并验证卡信息进行支付的行为，媒介包括POS、闪付、电话支付、线上收银台等载体。
- 账基支付：以账户作为支付工具、提供并验证账户信息进行支付的行为，账户包括银行账户、钱包账户等账户种类。

``` 
做支付先要做收单。
```

账基支付的意义：

- 丰富支付手段，账基支付支持卡基支付，还支持积分、余额等多种支付方式。
- 更加了解用户，深度分析用户行为。卡基支付情况下，同一个用户不同银行卡上交易是零散的，没有任何联系；而账基支付将一个用户的支付行为都关联起来，为行为分析和征信用户画像做了数据准备。

### 按通道支持的发卡行地区

- 内卡通道：发卡行为中国境内银行（包括外资银行）、本币为人民币、卡组为银联；
- 外币通道：发卡行为境外银行或者中资银行的境外分支机构、本币为外币、卡组为银联，Visa，Mastercard等；

## 支付通道接入

不同的支付通道有不同的特点，所以在接入的时候，要确保支付通道能满足要求。比如要确定支付通道支持那些支付品牌、cardbin、交易类型。

### 交易类型

- 消费：授权、扣款交易；
- 鉴权：身份验证，不涉及金额；
- 预授权：商户向发卡机构取得一定金额内的扣款权利，后续再向发卡机构进行承兑的业务，消费和结算不在同一时间完成。（先冻结银行卡部分资金作为押金，后续按照实际消费金额结算：酒店、租车等业务）
- 代扣：由用户授权、商户主动发起，对用户指定账户进行扣款。如：会员自动扣费。
- 代付：有商户主动发起，从自身结算账户付款给用户资金账户。如理财分红、薪资发放。

关联交易：冲正、查询（查询范围签约、交易、退货、协议号状态等）、撤销（当日撤销）、退货（隔日走退货，当日退货是否也支持）、预授权关联交易、解约/解绑。

冲正是系统对于交易结果未知的补偿机制。商户因为系统超时异常等原因，不确定支付结果，为了避免用户等待或者重复扣款，向支付服务提供商发起冲正交易请求，进行交易回滚，无论原交易是成功还是失败，均要求取消该笔交易。冲正成功后，商户可以向用户反馈支付失败或者再重新发起交易。

快捷支付：通常是和用于先签约，生成Token，后续支付机构根据Token进行支付，而不再验证银行卡要素。



## 直连与断直连

直连是指支付机构与银行直接连通，绕过银联等卡组织。好处是成本低，提高了效率；但是信息不透明不利于监管，且对于中小支付机构不公平（没资源）。

断直连：所有第三方支付机构接入网联。

# 跨境支付

跨境支付指使用一定的结算工具和支付系统对于资金在多个国家之间的转移。包括：境外线下支付、跨境转账汇款、跨境线上支付。

境外线下/线上支付本质上基于交易进行的支付行为，底层驱动是商品和服务的跨国转移。比如商品转移：AliExpress的B2B、执御的B2C跨境电商交易。服务转移：Trip、Booking、Agoda等的机票、酒店、餐饮等跨国旅游服务支付，Google、Facebook广告支付。

跨境转账汇款本质上是基于转账进行的支付行为，底层驱动是人口的跨国转移。比如留学：国内家人给英国留学生汇款，或者移民汇款。

跨境支付最主流的有两种：电汇和第三方支付。

## 电汇

电汇是指汇出行 应 汇款人申请，通过电子报文 指示国外 汇入行（目的地分行或代理行）支付对应金额 给汇款人的方式。

![电汇的信息流与资金流](\assets\reading minutes\2024-08-25-minute-payment-methodology\3.png)

电汇主要有两种模式：清算行模式和代理行模式。

清算行模式相当于汇入行在汇出行当地有营业部，中国人民银行制定中国银行境外分行为当地人民币境外清算行，且清算行与境外商业银行签订人民币代理结算协议，为其开立人民币同业务往来账户。具体的流程如下：

如果美国的A要汇50W人民币给中国的B：

1）境外汇款人A在美国JP银行汇出款项；

2）JP通过SWIFT系统与中国银行境外分行进行资金处理；

3）中国银行境外分行与与境内中国银行进行行内资金处理；

4）境内中国银行与汇入行工行通过CNPS（中国现代化支付系统）进行资金处理；

5）汇入行工行将款项汇入到B账户。

代理行模式相当于汇出行国家直接将款项汇入汇入国，在汇入过程中需要经过中转机构。具体流程如下：

1）境外汇款人A在美国JP银行汇出款项；

2）JP通过SWIFT系统与境内中国银行进行资金处理；

3）境内中国银行与汇入行工行通过CNAP进行资金处理；

4）汇入行工行将款项汇入到B账户。

## 第三方支付

两种主要表现形式：一种是通过独立品牌账户进行支付，一种是通过聚合多个品牌实现支付。

### Paypal（账户支付）

账户支付以账户作为支付工具、验证账户信息并进行支付的行为。核心是实名认证。收款方式主要有链接支付（邮箱支付、Paypal.Me）和收银台支付（账户支付、卡信息支付）。

收银台支付是在用户付款过程中需要商户打开Paypal收银台完成收款的支付行为。

### Adyen（聚合支付）

Adyen实现“一点接入，多产品可用”，Adyen模式主要是 客户平台 - Adyen - 卡组 - 发卡行。

Adyen相对于Paypal有更多的控制权：

- 保持商户平台支付界面的统一性；
- 方便商户自己处理支付逻辑；
- 流程简洁性。

# 支付路由

在通信工程领域中，“路由”被定义为一个交换中心呼叫另一个交换中心时，在多个可传递信息的途径中进行选择，选择途径的过程就是路由。简单来说，从A地到B地有多条路径，路由就像路牌用于指路。

在支付里，路就是接入的支付通道，比如银联、工行上海分行直连等。支付路由就是要找到既符合客户支付要求也符合自身收益最大化的路。路要求是有效的，不能是处于维护中的；路要满足客户需求，不能客户要快捷支付（好比客户要求坐飞机），你给个无磁无密支付（安排坐汽车）。**简单来说，路是介入的支付通道。路由就是帮助选择合适的支付通道。**

## 路由系统

路由系统是支付核心系统，对商户支付页面进行管理与输出、根据商户需求及通道特性基础对交易进行处理，并在此基础上对支付中的异常情况进行支付备灾处理。

主要包括引导路由和交易路由。

引导路由是用户能够看到的，有商家展示那些支付品牌机排序；具体方案包括：

- 推荐支付方式
- 支付品牌排序列表
- 推荐常用卡策略：向客户推荐常用卡的策略，如上次使用或者成本优先

交易路由是用户看不到的，每笔交易走什么支付通道；具体方案包括：

- 计算交易手续费：交易路由系统会调用计费模式，计算当前交易在每个可用通道中所需的手续费，并将通道按此交易成本从低到高排序；
- 匹配路由规则：交易路由系统根据交易请求，将可可用道按照路由算法优先级进行匹配，与规则匹配的目标通道会进行交易转发；
- 匹配分流策略：如果交易需要分流，按照分流策略进行转发。
