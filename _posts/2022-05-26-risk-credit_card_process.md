---
layout: post
title: "信用评分卡开发流程"
date: 2022-05-26
description: "信用评分卡开发流程"
tag: 风控
katex: true
---

# 种类

1. A卡(Application scorecard)：贷前准入、授信额度，判断好客户还是坏客户；
2. B卡(Behavior scorecard)：贷中管理，按月对未逾期的贷款根据各种行为进行评分；
3. C卡(Collection scorecard)：贷后催收评分卡，预测逾期案子未来还款概率。延伸：失联率、还款率
4. F卡：欺诈卡

# 开发流程

数据收集 - 数据准备处理 - 变量筛选 - 粗分类 - 建立模型 - 模型验证 - 评分卡拉伸 - 部署模型

## 数据收集

### 内部收集

1. 客户填写的申请资料
2. 已经贷款后的用户的行为数据
3. 逾期用户的贷后管理数据

### 外部收集

1. 购买（同盾、公安OCR）
2. 爬虫（黑名单、法院执行名单）
3. 第三方合作（芝麻分）

## 数据准备

### 数据处理

1. 异常数据：K-means、箱型图（找原因保留、建模去除）
2. 缺失数据：平均、中位数、众数填充

### 数据定义

1. 坏客户定义

   参考1：金标准M3（90+，在PPD是60-90，避免用户还款习惯，资金周转原因）；

   参考2：折中M2（60+，在PPD，M2是30-60）；

   参考3：M1（30+，在PPD，M1是15-30）

2. 样本量

   参考1：模型特征数量的10倍；

   参考2：信用评分卡公认至少1000个好的和1000个坏的贷款记录

3. 观察期与表现期

   观察期：搜集变量、特征的时间窗口，通常6-24个月。

   表现期：准备预测的时间长度，通常为12-24个月。

   详细说一下这个时间的定义。举例，当一个申请人在2022/5/26这天来申请贷款，现在需要用已有的模型对申请人进行一个申请评分，评估他未来一年（表现期）内违约或者是逾期的概率，然后决定是否放贷。这个已有模型是什么时候建立的呢？从之前的表述可以定义观察期为3年，表现期为1年，那么往前推1年为 2021/5/26号为观察点，再往前推三年（即观察期：2019/5/26 到 2021/5/26），利用这3年所有观察点内申请人信息建立模型的特征，然后在往后推一年（即表现期：2021/5/26 - 2022/5/26），所有在观察点内的申请人在这一年内的表现情况来定义违约（Target）。然后训练出一个模型。

## 变量筛选

变量分为连续型变量和离散型变量。首先，从所有数据中挑选或组合出可能影响风险的变量，这些一开始先挑出的变量群被称为长变量列表（Long List），由于数量较多，因此必须先检查这些变量之间的相关性。若变量间存在高度相关性，之后只要依预测能力及稳定度择一保留即可。

### 相关性分析

1. Pearson Correlation：变量符合正态分布
2. Spearman Correlation：变量不符合正态分布

接下来进行单因子分析，以检查各变量的预测强度。

![WoE及IV](/assets/risk/2022-05-26-risk-credit-card-process/2022-05-26-risk-credit-card-process-1.png)

这里以一个连续型变量Income来做示例，一开始根据数字大小切分较细的组别。分组的原则为：

- 组间差异大，组内差异小；
- 分组占率不低于5%；
- 各组中必须同时有好样本与坏样本。

其中表中有两个重要的指标WoE和IV。

### WoE （Weight of Evidence）

即证据权重，自变量取某个值的时候对违约比例的一种影响。绝对值越高，表示该区间好坏样本的区隔能力越高。各组之间WoE值差距应尽可能拉开并呈现出单调的趋势。如橙色标注为单调趋势。
$$
WoE_i = \ln (\frac{Bad \ Distribution}{Good \ Distribution}) \\
Bad \ Distribution = \frac{Number \ of \ Bad_i}{Total \ Number \ of \ Bad} \\
Good \ Distribution = \frac{Number \ of \ Good_i}{Total \ Number \ of \ Good }
$$


### IV（Information Value）

即信息价值，体现变量预测能力的强弱，做特征选择。相当于WOE的加权求和。
$$
IV_i = (\frac{B_i}{B_T} - \frac{G_i}{G_T}) * \ln(\frac{B_i / B_T}{G_i / G_T}) \\
= (\frac{B_i}{B_T} - \frac{G_i}{G_T}) * WoE_i \\
IV = \sum_{i=0}^n IV_i
$$


|     IV     |       预测能力        |
| :--------: | :-------------------: |
|   < 0.02   |      无预测能力       |
| 0.02 - 0.1 |         较弱          |
| 0.1 - 0.3  |         一般          |
| 0.3 - 0.5  |         较强          |
|   > 0.5    | 可疑(可能overfitting) |

大于0.02，初步筛选通过。如红色部分，该特征的IV为0.147，具有预测能力。

为了使IV提高，需要调整合并WoE相近的区间，最后得到的分组结果称为粗分类。待长变量列表中的所有变量IV都计算完成后，可从中挑选变量，**优先排除高度相关、趋势异常、不容易解释的**。经过筛选后的变量集合称为短变量列表，即为模型的候选变量。

## 建立模型

将候选变量喂给逻辑回归模型

逻辑回归的结果是几率Odds的自然对数，若想将结果以分数形式呈现，需要进行转换：
$$
Score = A - B * \log(Odds)
$$
其中A作为补偿，即平移；B作为刻度，即缩放。我们希望模型预测概率的变化会引起分值以某一单位刻度发生改变，得到如下式：

假设在给定比率$\theta_0$时，对应的分数为$s_0$,当比率增加2倍变成$2 \theta_0$时，对应的分值增加PDO（Point of Double Odds），表示为$s_0 + PDO$ (PDO: 基准几率翻倍之后，增加的值):
$$
s_0 = A - B \log(\theta_0) \\
s_0 + PDO = A - B \log(2 \theta_0)
$$
求解A、B两个参数即可确定Score。
$$
B = \frac{PDO}{\log(2)} \\
A = s_0 + B \times \log(\theta_0)
$$
若p（坏客户）越小，Odds越小，$- \log(Odds)$ 为正数，Score越高。

## 拒绝推断

拒绝推断多适用于评分卡。这是由于模型开发使用的数据实际上并不是从申请总体中随机选择的（会存在一些强规则、反欺诈甚至通过审核用户放弃借款的情况导致筛除了一些数据）而仅仅是从过去已经被接受的账户中选择的。建模时若仅使用它们会造成模型的偏误。但被拒绝的部分是无法事后观测实际表现的，就无从得知有哪些案件在当时被误判，因此需要借助拒绝推论推测拒绝案件的好坏，以进行模型修正。

较常被使用的拒绝推断方法为扩充法，其概念是先以核准客户（现有客户）为样本建立初步模型，接着将拒绝案件套入该模型，以推测其好坏，再与原核准客户样本合并建立新的模型。

## 模型验证

### 区分度

常用的区分度指标有K-S值（Kolmogrov-Smirnov），通过衡量好坏样本的累积分布差值来评估模型的风险区分能力：
$$
\max |TPR - FPR|
$$

### 稳定性

群体稳定性指标PSI（Population Stability Index）衡量模型的预测值与实际值的偏差大小
$$
PSI = \sum_{i=1}^{n} (A_i - E_i) \times \ln \frac{A_i}{E_i}
$$
其中，$A_i$表示实际占比(Actual)，这里使用测试集数据；$E_i$表示预期占比(Expected)，这里使用建模样本。

|      PSI      | 模型稳定性 |
| :-----------: | :--------: |
|   [0, 0.1)    |     好     |
|  [0.1, 0.25)  |    一般    |
| [0.25,正无穷) |   不稳定   |
















