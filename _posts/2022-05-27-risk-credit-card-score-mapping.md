---
layout: post
title: "逻辑回归评分卡映射"
date: 2022-05-27
description: "逻辑回归评分卡映射"
tag: 风控
katex: true
---

## 评分卡逻辑

信贷业务评估的是客户的违约率，是[0,1]的概率，比如20%表示100个客户里面有20个客户违约，简称p。

在评分卡中，不直接使用p，而是使用odds。通过odds，将违约率和评分联系起来。评分卡的背后逻辑是Odds的变动与评分变动的映射（把Odds映射为评分），分值是根据Odds的前提条件算出来的，不是人工取的。
$$
p \ \rightarrow odds = \frac{p}{1-p} \ \rightarrow Score = A - B \ln(odds)
$$
下表展示了评分卡逻辑计算：

|  分值  |  Odds  | 违约率(p) |
| :----: | :----: | :-------: |
|   80   | 6.25%  |   0.6%    |
|   70   | 1.25%  |   1.2%    |
|   60   |  2.5%  |   2.4%    |
| **50** | **5%** | **4.8%**  |
|   40   |  10%   |   9.1%    |
|   30   |  20%   |   16.7%   |
|   20   |  40%   |   28.6%   |
|   10   |  80%   |   44.4%   |

比如评分从50升到了70，表示odds从5%降到了1.25%，进一步表示违约率从4.8%降到了1.2%。

## 评分映射公式

$$
Score = A - B \ln(odds)
$$

使用该公式需要有两个假设：

- 在某个特定odds下对应特定的预期分值 $S_0$
- 指定odds范范时，分值的变动值PDO

解释：

1. 比如根据业务经验，信贷的客户违约率4.8%算正常，对应odds=5%。预设评分卡的分值为0-100，那预期分值$S_0$为50分，并指定odds按双倍上下浮动时（比如2.5%或10%），分值则对应上下变动10分（比如60分或40分）；
2. odds=5%是根据业务经验得来的，没有数学依据；
3. 0-100分是根据评分卡的需要来的，没有数学依据，也可以做成600/650/700的评分卡，更改$S_0$；
4. $S_0=50$是根据0-100分来的，也可以取45分或73分，不重要。重要的是随着odds翻番变动时，分值也会随之变动。

### 求解A、B

$$
Score = A - B \ln(odds)
\\
Score + PDO = A - B \ln(2odds)
$$

求解得：
$$
B = \frac{PDO}{\ln(2)}
\\
A = Score + B \ln(odds)
$$
按照上面的解释举个例子：

$S_0=50$、odds=5%、PDO=10则：
$$
B = \frac{10}{\ln(2)} = 14.43
\\
A = 50 + 14.43*\ln(0.5)=6.78
$$
所以：
$$
Score = 6.78 - 14.43 * \ln(odds)
$$
按照公式，可以把所有 odds=p/(1-p) 和客户评分score、客户违约率的对应关系

|     分值     |     Odds      | 违约率(p) |
| :----------: | :-----------: | :-------: |
|      80      |     6.25%     |   0.6%    |
|      70      |     1.25%     |   1.2%    |
| 60 = 50 + 10 | 2.5% = 5% / 2 |   2.4%    |
|    **50**    |    **5%**     | **4.8%**  |
| 40 = 50 -10  | 10% = 5% * 2  |   9.1%    |
|      30      |      20%      |   16.7%   |
|      20      |      40%      |   28.6%   |
|      10      |      80%      |   44.4%   |

## X变量细分到分组

评分卡里每一个变量的每一个分箱有一个对应的分值。将各变量分组的评分相加得到客户总评分，这里输入的X变量不能是原始变量，而是原始变量分箱后的Woe值，类似离散变量中个类别的数值化。
$$
Score = A - B[\beta_0 + \beta_1(\delta_{11}w_{11} + \delta_{12}w_{12}+\delta_{13}w_{13}) + \beta_2(\delta_{21}w_{21} + \delta_{22}w_{22})]
$$

假设有两个变量$x_1$、$x_2$分别有3、2个分类（数值型变量先分箱成为类别型变量）

$\delta_{ij}$代表第i个变量的第j个分类，客户数据参与评分时，某个变量x只会有1个数，只会对应一个分类。比如，变量$x_1$的取值是第2个分类，则$\delta_{12}$为1，则第二个分类的woe：$w_{12}$值生效，其余则为0。

生成评分卡：

|  变量  | 行数 |      分值      |
| :----: | :--: | :------------: |
| 基准点 |  ——  |  （A-B beta0)  |
|   x1   |  1   | -(B beta1 w11) |
|        |  2   | -(B beta1 w12) |
|        | ...  |      ...       |
|        |  k   | -(B beta1 w1k) |

A、B已经算出，$\beta$是逻辑回归模型的输出系数，$\beta_0$是逻辑回归模型输出的截距项，w是分箱后的woe值。

