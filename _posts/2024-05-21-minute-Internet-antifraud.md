---
layout: post
title: "风控要略 互联网业务反欺诈之路"
date: 2024-05-21
description: "风控要略 互联网业务反欺诈之路读书笔记"
tag: 读书笔记
---

# 黑产

## 黑产攻击行为特点

- 团伙化：黑产已经从单打独斗发展成了有组织的团伙，通过合理 分工协同工作。
- 专业化：黑产上下游之间分工明确，相互协作，拥有大量的作案 资源（身份证、银行卡、手机号、手机设备IP 资源等）。
- 强对抗性：黑产熟悉主流的风控技术手段，会根据业务实际情况 不断试探、挑战和绕过现有的防护体系。
- 跨行业：黑产会在电商、广告、支付、航旅等多个平台流窜作 案。

## 黑产的具体行为

- 垃圾注册：利用虚假信息（临时邮箱、虚假邮箱、虚假号码等）进行注册账号，或者使用脚本、注册机进行批量注册。
- 薅羊毛：使用虚假身份信息或者自动化工具参与各类营销活动的行为，营销活动包括但不限于折扣、返现、抽奖、满减等形式，并且不能 给平台带来实际的活跃用户或订单交易。
- 黄牛/刷单：在合法销售途径以外，垄断、销售限量参与权或商 品，并以此牟利的中介人称为黄牛。
- 众包：由多个独立的个体共同完成的一项任务称为众包。
- 炒信：通过各种途径和手段进行虚假交易，快速提升商户交易 量、信用等级的行为统称为炒信。
- 套利：由商户端发起的薅羊毛行为。
- 空包：虚假发送快递，发送空的快递或包裹。

## 黑产武器库

### 虚假号码

这里所说的“虚假号码”是运营商真实存在的手机号，但这些手机号 未经实名认证，可以用于代替他人接收验证码。

- 猫池（Modem Pool）：用于控制和管理SIM卡的设备；
- 接码平台：虚假号码的集散地。手机卡接受到的短信上传到接码平台；

### 代理IP

黑产为了突破 业务平台使用的IP 黑名单、操作频率限制等风控策略，也常常使用代理 IP 来进行相关的攻击活动。

### 设备伪造工具

- 改机工具：更改手机串号、手机型号、MAC地址、无线名称、手机运营商、手机号；
- 多开工具：开启多个相同的应用程序；
- Root/ 越狱工具：root-Android 越狱-IOS 普通应用拥有系统管理员权限；
- Xposed：基于Android常见的hook框架，开发者可以任意修改Android操作系统的java代码，如自动抢红包、修改步数、消息防撤回等；
- CydiaSubstrate：一款IOS常见的hook框架，越狱时会同步安装该软件。开发者可以非常方便地替换IOS操作系统的Objective-C/C/C++函数。
- Frida：轻量级hook框架，支持Android和IOS操作系统。
- 硬改工具：Android 是开源操作系统，开发者卡发出可以随意修改手机操作系统参数的ROM。硬改的设备可以在本地随机生成设备参数，也可以从云端设备库动态下发其他设备的真实参数。
- 脱机挂：指把原有客户端代码逻辑使用程序模拟执行。
- 备份恢复/抹机恢复：备份恢复是对iOS 设备某一特定时期的数据进行备份，以备在需要 时将设备恢复到某一时期的操作。抹机恢复就是将设备完全重置，恢复成出厂设置。
- 模拟器：包括Android模拟器，Android云模拟器，IOS模拟器。Android云模拟器在 ARM 主板上同时运行多个Android 操作系统，然后通过远程控制工具实 现近似于本机的用户操作，还可以实时分享给其他人观看。
- 定制浏览器：自定义浏览器对象参数，达到伪造新浏览器的目的，此外还提供自动代 理、群控、cookie 机器人、设备标准库等功能。
- 自动化脚本：selenium、plantomJS、nightmareJS、puppeteer 都是Web 应用程序的 自动化框架，它们利用浏览器驱动实现自动化操作网页，支持无界面模 式（headless）。在移动端也有很多自动化脚本工具，如按键精灵、触动精灵等。

### 其它工具

- 位置伪造工具：想要修改手机GPS 定位，可以使用改机工具修改GPS Location，也可以使用业余无线电设备发送虚假的GPS 信号。

- 群控：通过技术手段远程控制大量移动设备的系统。这项技术在很多领域都有成熟的应用，如云测平台、 自动化测试。黑产在自动化测试框架基础上增加了改机功能，用于批量 操作真机注册、养号、机器人等。

  大部分黑产在选择群控设备时，偏向于价格低廉、性能稳定的机 型，比如下述机型：

  小米系列：MI 4、MI 4c、MI 5

  红米系列：Redmi3、Redmi 3s、Redmi 4

  华为系列：华为麦芒、C8818

  随着群控设备供应商的技术升级，黑产进一步压缩群控系统的搭建 成本，出现了“箱式群控”，箱控将手机主板通过电路集成的方式集成到一个主板内进行统一供电，以实现一台箱控操作几百台手机的最终目的。

- 工具箱：各种工具的集合。

```
针对以上黑产工具，风控可以从手机号/卡号/用户、IP资源、设备维度定制更强有效的防控策略。
```

# 反欺诈体系建设

## 动态防控理念

事前：前端风险识别能力。通过态势感知系统为整体防控效果做监控，当业务指标发生非预期的波动时立即预警。

事中：建立基于账号、设备和黑产情报的三位立体风险模型和智能决策机制，防控欺诈交易。

事后：溯源案件、将分析结论整理到案件库。

![风险防控流程](\assets\reading minutes\2024-05-21-minute-Internet-antifraud\1.png)

## 防控体系构建

三层-反欺诈防控体系包括终端风控层、分析决策层和数据画像层，威胁情报体系贯穿三层。

![三层反欺诈防控体系](\assets\reading minutes\2024-05-21-minute-Internet-antifraud\2.png)

1.终端风控层主要是为了采集数据。主要由设备指纹、生物探针和智能验证码构成。

- 设备指纹的核心能力就是能够采集到设备信息，每一台设备的唯一ID；

- 生物探针采集终端的操作行为、传感器信息等数据综合建模，通过机器学习区分出操作业务的是自然人还是自动化工具；
- 智能验证码也是区分操作业务的是否为自然人。适用于特定场景对抗机器批 量行为，需要用户进行拖动、点击等交互操作。智能验证码是影响用户交互的。

2.分析决策层是各种数据、规则和模型汇总计算的中心。包括决策引擎、实时指标计算、风险态势感知、机器学习。其中，风险态势感知侧重于宏观的统计分析。利用业务核心数据、设备信息及风险决策结果等各类数据，通过预置的分析算法模型进行实 时、H+1、T+1多种周期组合的分析计算。其核心功能是感知、展示和预测整个业务体系的风险事件变化趋势。

3.数据画像层包括黑产攻击事件、黑手机号名单、IP 画像、设备画像。黑产使用的手机号、IP、手机设备等资源是相对有限的，会重复用于针对各个不同互联网平台的攻击活动。

4.欺诈情报体系作为贯彻整个流程的重要子系统，为整体的防控效果提供了“攻击者视角”的能力补充和评估。通过对黑产社区的监控、黑产动态的追踪和自动化分析研判，欺诈情报体系能够快速感知到防护体系中的弱点，驱动风控运营人员进行针对性的优化。

后面逐一详细介绍每个板块。

# 设备指纹

设备指纹（Device Fingerprint）通过收集客户端设备的特征属性信息并将其加密上传到云端，然后通过后台的算法分析为每台设备生成唯一设备ID 来标识这台设备。

## Android 设备指纹

Android设备指纹：Android ID、IMEI/MEID、UDID（APP重装不会改变）、UUID等。

从理论上来说，所有的采集项都是Android系统公开的API，不可能在采集项被大面积篡改的情况下保持设备ID 不变。因此，设备指纹还需要对APP 运行环境进行监测，以识别异常环境，针对Android 作弊环 境的检测方法可以归纳为以下5个方面：

- 通过安装包检测安装的作弊工具；
- 通过特定特征识别root 环境；
- 使用多种方案采集同一字段信息；
- 通过通用性的作弊原理识别运行的作弊框架hook（Java/native）；
- 通过特定特征识别运行的作弊工具和模拟器；

## IOS 设备指纹

IOS设备指纹：IDFA（广告标识符）、IDFV（厂商标识符）

iOS 设备指纹风险识别技术可以归纳为以下6种：

- 通过通用hook 原理识别技术检测运行的作弊工具。 
- 通过特定作弊工具特征识别运行的作弊工具。 
- 通过特定特征识别越狱环境。 
- 寻找特定的空间存储设备标识。 
- 对抗hook 改机。 
- 对抗备份和抹机。

## Web 设备指纹

Web 设备指纹（又被称为浏览器指纹）是由用户设备硬件信息和浏览器配置信息综合计算产生的，它通过JavaScript 脚本采集信息生成对应的设备ID。

主要由：UA（User Agent）用户代理，可以带出浏览器版本、CPU信息等；IP、语言等；

Web 设备指纹风险识别技术可以归纳为：

- 识别浏览器端异常环境。
-  通过特定特征识别hook。
- 通过特定特征识别JS 是否被篡改或正在被调试。
- 通过浏览器特殊方式存储设备标识，防止存储的标识被删除。

Web 设备指纹的实现过程主要分为两部分：**其一为设备指纹的稳定性，即需要收集较为稳定的设备信息**；**其二是作弊环境检测，即保证当前Web 设备指纹采集到的信息都是真实的。**

[设备指纹见该链接]: https://mp.weixin.qq.com/s?__biz=MzA4OTAwMjY2Nw==&amp;mid=2650191152&amp;idx=1&amp;sn=56d1b66ed696055ab8efeddd23a4e368&amp;chksm=882392f4bf541be2340f691cba093173faf42266f4c41fcfe8ae9a8f1d188d8989ee9bb050d3&amp;scene=21#wechat_redirect

# 基于用户行为的生物探针

身份认证主要有四个阶段：

- 第一阶段 Something you know （只有你知道的信息）：账号、密码、手机号、身份证信息；
- 第二阶段 Something you have （只有你拥有的物品）：动态密码卡、IC卡、磁卡；
- 第三阶段 Something you are （只有你拥有的生物特征）：指纹、声纹、人脸、虹膜；
- 第四阶段 Something you do （你特有的行为）：用户的点击、按压、滑动、滚动、击键操作；

第一阶段、第二阶段典型的认证方式包括：单因素认证（账户+密码）、双因素认证（账户+密码+U盾）；第三阶段稳定性、丰富性得到提升，但是不能进行持续、无感的身份认证；第四阶段为生物行为模式识别，通过机器学习对用户的点击、按压、滑动等行为进行只能计算和验证。

## 生物探针

生物探针通过采集用户使用智能终端设备（如手机、电脑等）时的传感器数据和屏幕轨迹数据，然后通过特征工程、机器学习，为每一位用户建立多维度的生物行为特征模型，生成用户专属画像进行人机识别、本人识别。生成用户画像使用的是非敏感生物学特征（不采集用户人脸、声纹等敏感信息和隐私数据），通过算法模型确保唯一性，并且能够对抗伪造和复制。

智能手机有很多传感器，包括加速度计、陀螺仪、重力加速度计、磁场传感器计等。这些传感器能够记录用户使用手机时的状态数据，如加速度传感器能够记录手机的线性加速度大小，重力加速度记录手机的重力加速度，陀螺仪记录手机的角加速度。

应用场景：

- 登录场景
- 小额转账免短信场景
- 支付免密场景
- 信用卡、消费、借贷申请场景

# 智能验证码

验证码的本质是 反向的图灵测试。用来判断是真人还是机器。黑产对多种验证码已经有了比较好的解决方法。

- 字符类验证码：AI识别：KNN、CNN、GAN；
- 滑块拼图验证码：OpenCV提供了API；
- 图文点选验证码：识别语义
- 打码平台：直接让验证码失效！！！

## 对抗黑产的方案

- 加入AI技术，利用GAN（对抗生成网络技术）来无限生成各种色彩斑斓的鸟。验证的问题可以是“这个鸟的某个部位是什么颜色？”
- 空间旋转验证方式
- 轨迹模拟
- 对于打码平台，在验证码前端，做高强度的动态代码混淆，防止黑产轻易得到验证码的交互逻辑。

# 风险态势感知系统

风险态势感知是以安全大数据为基础，从全局视角提升对业务安全威胁的发现识别、理解分析和处置响应的一种方式。

风险态势感知系统的方法主要有基于统计分析的方法、基于半监督、无监督算法的聚类方法和基于业务情报的方法，这些分析方法基于以下几个前提：

- 正常业务具有连续性和稳定性，异常事件具有波动性；
- 正常用户总是表现出分布离散性，而黑产总是表现出聚集性；

![风险态势感知](\assets\reading minutes\2024-05-21-minute-Internet-antifraud\3.png)

## 基于统计分析的方法

核心的统计数据包括：

- 核心风险事件数据：风控系统事件请求量、拒绝率、人审率等；主要考察这些指标是否有激增，异动，可以计算PSI（群体稳定性指标）比如：
  $$
  PSI = (当日拒绝率-历史拒绝率) \times \ln (\frac{当日拒绝率}{历史拒绝率})
  $$
  或者规则命中PSI：
  $$
  PSI = (当日规则命中量-历史规则命中量) \times \ln (\frac{当日规则命中量}{历史规则命中量})
  $$

- 核心业务数据：根据不同业务的核心指标进行统计；

## 基于无监督学习的方法

一般包括：特征抽取、建立连通图、群组和聚类等。

## 基于欺诈情报的方法

当业务系统发生漏洞被黑产利用时，黑产往往会通过论坛、社交网站、社交软件等方式进行讨论和分享。如果情报系统捕获到这些信息后，提取业务场景、漏洞类型、攻击手法等信息。

## 预警系统

对于同比、环比、均值、最大值、最小值等指标进行预警，一般来说预警配置的阈值调优非常重要，误报率要控制在10%以内。

# 风险数据名单体系

名单包括：黑名单、灰名单、白名单。

黑名单为高风险特征；

灰名单为风险不高或者与风险不直接相关的数据。我们通过一些技术手段判 断出一批设备是更改过机型的Android 设备，使用这些设备的用户有可能是为了进行业务环节的攻击，也有可能是其他原因（如很多游戏用户为了流畅地玩某款游戏，会按照网上的教程把自己的手机进行改机，修改型号和机型等参数）。这批设备就只能放在灰名单中进行观察。

白名单：重点保护的客户，比如公司高管。

## 名单体系的价值

- 业务初期，风控措施不完善的时候，名单规则可以起到一定的风控效果。
- 通过名单可以做一些关联挖掘，风控人员通过数据分析，可以挖掘与该团伙关联的设备、IP 和其他可能的手机号，甚至挖掘该团伙的攻击模式和作弊工具特征。

## 名单体系的设计

首先，明确用于建立名单的数据主键：客户号、卡号、手机号、身份证号、设备号等。

其次，明确标签的类别。标签可以指向一种明确的风险，如“刷单"手机号黑名单；也可以指向一种风险相关的特征，如”虚假号码“的手机号名单。

名单数据是具有生命周期的。

# 欺诈情报体系

欺诈情报：黑产团伙在使用哪些资源和技术手段危害互联网业务的正常运营，包括但不限于获取“刷单”“薅羊毛”等黑产攻击事件细节、黑产新型的作弊工具及黑产使用的各类资源信息。

欺诈情报分为三类：数据情报、技术情报和事件情报。

数据情报：能够沉淀手机号、IP、设备及邮箱账号等黑产名单数据的情报信息。这类情报对互联网平台是具有价值的情报，可以进行直接使用，快速打击黑产，为平台止损。

技术情报：针对某一种欺诈技术的详细信息，包括原理、用途、危害等。

事件情报：情报体系捕获的某欺诈事件即将发生、正在发生或已经发生过的信息均可称为事件情报。

对于一次欺诈事件来说，需要综合各方面进行分析，梳理清楚其来龙去脉：

- 黑产团伙为什么这么做？
- 黑产团伙是具体如何操作的？
- 黑产团伙如何绕过已有的一些风控策略？
- 黑产团伙是否使用了比较特殊的欺诈技术或者手段，其原理是什么？
- 黑产团伙使用了哪些资源？这些资源从哪里获取的？
- 预计有多少黑产团伙参与这次欺诈事件？
- 针对同类型的欺诈行为，是否有比较好的防控建议？

# 典型反欺诈业务场景风险分析

在享受互联网服务时，需要完成一环一环的业务场景：注册、登录、申请验证码、参与营销活动、购买商品、支付或退款等。

## 垃圾注册

在注册环节中，使用虚假、不稳定的身份信息（虚假号码、通信小号、临时邮箱、虚假邮箱），通过定制脚本进行批量注册。

黑产注册小号首选套路是：直接使用接码平台提供的虚拟号码，使用模拟器、群控设备、云手机等模拟设备环境，再通过脚本调用进行批量注册。

防控维度：

- 手机号黑名单、IP黑名单
- 设备指纹识别终端风险：模拟器、安装作弊工具设备、参数异常设备、参数篡改设备、疑似刷机设备等；
- 识别异常行为：对平台历史数据的指标计算得到频繁注册的设备、IP、手机号

```
可以对发现异常的账号进行打标，允许注册和登录，但不允许参与后续的其他活动。从攻击者的角度来看，如果策略直接在注册或登录环节被拦截，那么很容易通过多次尝试，测试出风控的策略，极大地降低了攻击成本。
```



## 登录

分为：被黑产盗号登录 和 黑产养号登录

### 盗号场景

盗号一般是黑产对胡来内网平台托库、撞库或者暴力破解盗取到用户账号密码；

防控维度：

- IP黑名单
- 设备维度防控：通过设备指纹识别自动化登录脚本、虚假设备、 作弊设备、是否是常用设备、是否是常用地址等。
- 短时高频+失败率：同一设备或IP上登录过多账号、同一账号频繁更换密码登录

### 养号场景

黑产养号一般需要群控，所以呈现聚集性：

- 多个账号聚集在同一设备、IP段、WIFI；
- 多个账号使用不同的设备 ID，但是用了相同的改机工具；
- 多个账号在用户操作行为上存在相似性；
- 多个账号在昵称、头像、个人简介等方面具有随机性，但有一定相似性；

防控维度：

- IP黑名单、设备黑名单
- 频率：同一设备、IP、WIFI上账号的频次
- 算法

## 薅羊毛

我们笼统地把使用虚假身份信息或自动化工具参与各类营销活动的 行为称为“薅羊毛”。

在领券和提交订单防控维度：

- 黑名单：手机号、IP、设备
- 设别风险：虚假设备、作弊设备、批量脚本；
- 频率维度
- 购买某个特惠商品的账户群体缺少交易外的其他平台活跃动作
- 虚假相似收货地址
- 与区域快递合作，地址中包含案号
- 地址中包含实际下单收货号码

## 裂变拉新作弊

利用邀请人账户ID，防控维度：

- 某邀请人短时大量要请注册新账户
- 某邀请人名下新注册的手机号、设备、IP异常比例高
- 某邀请人名下新注册设备特征相似
- 某邀请人名下新注册账户团伙行为相似

## 任务作弊

资讯类APP完成阅读文章、观看视频、收藏点赞等行为获得奖励：

- 作弊工具、自动化脚本
- 群控特征：如设备长期静止

## 恶意退单

识别出该风险后需要对账户进行处置：

- 积累历史行为数据，识别频繁退单账户、退单率高的账户
- 对账户分级管理，对高风险账户增加二次验证
- 退单后，退款需审核，延时到账
- 相似地址聚类及虚假地址核验

