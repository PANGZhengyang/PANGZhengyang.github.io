---
layout: post
title: "ABTest样本量"
date: 2021-05-02
description: "ABTest样本量"
tag: 数据分析
katex: true
---

## AB  Test的样本量越多越好吗？

从理论来说，测试的样本量越多越好，毕竟越接近总体；但是在实际应用中，并不是这样，反而希望样本量少一些。具体原因如下：

- 测试时间 = 测试所需样本量 / 每日平均得到的样本量。如果所需样本量越大，则我们需要做测试的时间越长；
- 成本：做测试时需要成本的，如果你的改动会带来不好的效果，你用在了大量的样本中，会带来比较大的损失

所以，一个好的实践是找到能够使统计上显著的最小样本量~

## AB Test样本量公式

**每一个实验组**所需的样本量计算公式如下：

$$
N = \frac{(z_{1-\frac{\alpha}{2}}+z_{power})^2 \ \sigma^2}{\delta^2} \\
\sigma -样本标准差 \\
\delta -组间预期差值
$$

通常 a 取0.05，power取0.8 所以公式近似可得：

$$
N=\frac{8 \sigma^2}{\delta^2}
$$

### 估算实验组和对照组评价指标的差值δ

我们当然不会事先知道实验结束后的结果，不过可以通过下面的两种方法估算出两组评价指标的差值δ。

- 从收益和成本的角度进行估算

  业务 / 产品上的任何变化都会产生相应的成本，包括但不限于人力成本、时间成本、维护成本、机会成本，那么变化带来的总收益能否抵消掉成本，达到净收益为正呢？

  举个例子，我们现在想要通过优化注册流程来增加某 App 的用户注册率。假设优化流程的成本大约是 3 万元（主要是人力和时间成本），优化前的注册率为 60%，每天开始注册的人数为 100 人，每个新用户平均花费 10 元。如果优化后的注册率提升为 70%，这样一年下来就多了 3.65 万元（（70%-60%）* 100 * 10 * 365）的收入，这样的话一年之内的净收益就为正的，这就说明此次优化流程不仅回本，而且还带来了利润，也就证明 10% 的差值是一个理想的提升。当然，我们进行相应的改变肯定是希望获得净收益，所以一般我们会算出当收支平衡时差值为 δ收支平衡，我们希望差值 δ≥δ收支平衡 。在这个例子中， δ收支平衡= 8.2% (30000/10/100/365)，所以我们希望的差值δ至少为 8.2%。

- 从历史数据估算一个差值

### 计算实验组和对照组的综合方差

至于两组综合方差$\sigma^2$的计算，主要是选取历史数据，根据不同的评价指标的类型，来选择相应的统计方法进行计算。评价指标的类型主要分为概率类和均值类这两种。

- 概率类
  $$
  \sigma^2 = p_{control}(1-p_{control})+p_{test}(1-p_{test}) \\
  control - 对照组 ； test-测试组 \\
  p_{test} = p_{control} + \delta
  $$
  
- 均值类
  $$
  \sigma^2 = \frac{2 *\sum (x_i - \overline x)^2}{n-1}
  $$
  

## 影响AB Test样本量的因素

从上面的公式可以看出，有四个因素：

1. $\alpha$

   显著性水平越小，需要的样本量越大

2. $Power$

   power越大，需要的样本量越大

3. 组间期望差值 $\delta$

   差值越小，说明越不好被检测出来，样本量要更多

4. 方差 $\sigma^2$

   方差是用来表征评价指标的波动性的，方差越大，说明评价指标的波动范围越大，也越不稳定，那就更需要更多的样本来进行实验，从而得到准确的结果。

	![](/assets/2021-05-02-abtest-sample-size1.png)

