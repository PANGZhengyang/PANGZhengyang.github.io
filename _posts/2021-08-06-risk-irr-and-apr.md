---
layout: post
title: "IRR与APR"
date: 2021-08-06
description: "IRR与APR"
tag: 风控
katex: true
---

IRR即隐含报酬率（Internal Rate of Return），APR即年化利率（Annual Percentage Rate），在讲两种利率的区别之前，要先说一说目前市场上各种还款方式都是怎么计算利息的，以帮助理解。

## 还款方式

常见贷款产品中的几种还款方式有：

- 随借随还
- 先息后本
- 等本等息
- 等额本金
- 等额本息

### 随借随还

客户在获得授信额度后可以随时来支取，借出后就开始计算利息，并且可以随时还款，还款后额度会进行恢复。常见于银行的大额消费贷、借呗等。

$$
总利息 = 贷款本金 \times 日利率 \times 贷款天数
$$

举例：

> 本金12000，期限12个月，年利率10%
>
> 总利息 = 12000 * (10% / 365) * 365 = 1200

### 先息后本

每月支付利息，到期后一次性归还本金。这种还款方式更适合现金流压力较大，而一定时间后才会有一笔钱进账的个人或企业使用。

$$
月利息 = 贷款本金 \times 月利率 \\
总利息 = 贷款本金 \times 月利率 \times 还款期数
$$

举例：

> 本金12000，期限12个月，年利率10%
>
> 月利息 = 12000 * 10% / 12 = 100
>
> 总利息 = 12000 * 10% = 1200

### 等本等息

每个月偿还的本金相等，利息也相等。一般用于银行卡现金分期或者账单分期。

$$
月本息 = \frac {贷款本金} {还款期数} + 贷款本金 \times 月利率 \\
总利息 = 贷款本金 \times 月利率 \times 还款期数
$$

举例：

> 本金12000，期限12个月，年利率10%
>
> 月应还本息 = 12000 / 12 + 12000 * 10% / 12 = 1100
>
> 总利息 = 12000 * 10% = 1200

### 等额本金

在贷款期内每月偿还同等数额的本金和剩余贷款在该月所产生的利息。其特点就是，每期所还本金相等，利息逐月减少（根据剩余未还本金计算），总还款额逐月递减。等额本金是住房贷款的两种常见还款方式之一。

$$
月本息=\frac{贷款本金}{还款期数}+(贷款本金-已还本金)\times 月利率 \\
总利息 = 贷款本金 \times [1 + (1 - \frac 1 n) + (1 - \frac 2 n) + ... + \frac n n] \times 月利率 \\
= 贷款本金 \times [1+n-\frac 1 n (1+2+...+n)] \times 月利率 \\
= 贷款本金 \times [1+n-\frac 1 n \frac {(1+n)n} 2] \times 月利率 \\
= 贷款本金 \times 月利率 \times \frac{n+1} 2
$$

举例：

> 本金12000，期限12个月，年利率10%
>
> 每个月应还本金 = 12000 / 12 = 1000
>
> 第1月应还利息 = 12000 * 10% / 12 = 100
>
> 第2月应还利息 = (12000 - 1000) * 10% / 12 = 91.67
>
> …
>
> 第12月应还利息 = (12000 - 1000 * 11) * 10% / 12 = 8.33
>
> 总利息 = 12000 * 10% / 12 * (12 + 1) = 650

### 等额本息

在贷款期内每月按相等的金额偿还贷款本息，其中利息逐月递减，本金逐月递增。其特点就是，由于每月的还款额相等，因此，在贷款初期每月的还款中，剔除按月结清的利息后，所还的贷款本金就较少；在贷款末期每月的还款中，剔除按月结清的利息后，所还的贷款本金就较多。等额本息是住房贷款的两种常见还款方式之一。

已知内含报酬率$r$时，每期的应付本息计算方式如下，其中NPV为Net Present Value，PV为Present Value，CF为Cash Flow。

$$
NPV = -PV + CF \times [\frac 1 {1+r} + \frac 1 {(1+r)^2} + ... + \frac 1 {(1+r)^n}] = 0 \\
0 = -PV + CF \times \frac {\frac 1 {1+r} (1 - \frac 1 {(1+r)^n})} {1 - \frac 1 {1+r}} \\
0 = -PV + CF \times \frac {(1+r)^{n} - 1} {(1+r)^{n+1}} \frac {1+r} r \\
0 = -PV + CF \times \frac {(1+r)^n - 1} {r(1+r)^{n}} \\
CF = \frac {PV \times r(1+r)^n} {(1+r)^n - 1}
$$

举例：

> 本金12000，期限12个月，年利率10%
>
> | 期数 | 每期应还本金 | 每期应还利息 | 每期应还合计 |
> | :--: | :----------: | :----------: | :----------: |
> |  1   |    954.99    |    100.00    |   1054.99    |
> |  2   |    962.95    |    92.04     |   1054.99    |
> |  3   |    970.97    |    84.02     |   1054.99    |
> |  4   |    979.06    |    75.93     |   1054.99    |
> |  5   |    987.22    |    67.77     |   1054.99    |
> |  6   |    995.45    |    59.54     |   1054.99    |
> |  7   |   1003.75    |    51.24     |   1054.99    |
> |  8   |   1012.11    |    42.88     |   1054.99    |
> |  9   |   1020.54    |    34.45     |   1054.99    |
> |  10  |   1029.05    |    25.94     |   1054.99    |
> |  11  |   1037.62    |    17.37     |   1054.99    |
> |  12  |   1046.27    |     8.72     |   1054.99    |
>
> 合计利息：659.89，合计总还款额：12659.89

可以通过如下的R代码来计算一个等额本息贷款产品的还款计划表，注意其中rate为每期的IRR利率：

```R
repay_table <- function(amount, rate, periods) {
  require(kableExtra, quietly = TRUE, warn.conflicts = FALSE)
  require(dplyr, quietly = TRUE, warn.conflicts = FALSE)
  total_amount <- amount
  periodically_pay <- solve(sum(1/(1 + rate) ^ seq(1, periods)), amount)
  interests <- numeric()
  principals <- numeric()
  for (i in seq_len(periods)) {
    interest <- amount * rate
    principal <- periodically_pay - interest
    interests <- append(interests, interest)
    principals <- append(principals, principal)
    amount <- amount - principal
  }
  df <- data.frame(`期数` = 1L:periods, `每期应还本金` = principals, `每期应还利息` = interests, `每期应还合计` = periodically_pay)
  df %>%
    mutate_if(function(x) !is.integer(x), ~ round(., 2)) %>%
    kable('html', align = 'c') %>%
    kable_styling(bootstrap_options = 'bordered') %>%
    add_footnote(c(sprintf('总本金%.2f，每期利率%.4f', total_amount, rate), sprintf('合计本金：%.2f，合计利息：%.2f，合计总还款额：%.2f', total_amount, sum(interests), periodically_pay * periods)))
}
# 对于上面所举的例子
# repay_table(12000, .1 / 12, 12)
```

注意到，同样都是年利率10%，为什么不同还款方式的总利息存在差别？下面看看年化利率与隐含报酬率的区别。

## IRR与APR

### APR

年化利率，又称名义利率，年利率 = 总利息 / 本金。上一小节的五种还款方式分别对应的APR如下所示：

| 还款方式 | 本金  |  利息  |  APR  |
| :------: | :---: | :----: | :---: |
| 随借随还 | 12000 |  1200  |  10%  |
| 先息后本 | 12000 |  1200  |  10%  |
| 等本等息 | 12000 |  1200  |  10%  |
| 等额本金 | 12000 |  650   | 5.42% |
| 等额本息 | 12000 | 659.89 | 5.5%  |

### IRR

隐含报酬率，又称真实利率，是指净现值为0时未来现金流的折现率。上一小节的五种还款方式分别对应的现金流如下所示：

| 还款方式 | 随借随还 | 先息后本 | 等本等息 | 等额本金 | 等额本息 |
| :------: | :------: | :------: | :------: | :------: | :------: |
|    0     |  -12000  |  -12000  |  -12000  |  -12000  |  -12000  |
|    1     |    0     |   100    |   1100   |   1100   | 1054.99  |
|    2     |    0     |   100    |   1100   |   1092   | 1054.99  |
|    3     |    0     |   100    |   1100   |   1083   | 1054.99  |
|    4     |    0     |   100    |   1100   |   1075   | 1054.99  |
|    5     |    0     |   100    |   1100   |   1067   | 1054.99  |
|    6     |    0     |   100    |   1100   |   1058   | 1054.99  |
|    7     |    0     |   100    |   1100   |   1050   | 1054.99  |
|    8     |    0     |   100    |   1100   |   1042   | 1054.99  |
|    9     |    0     |   100    |   1100   |   1033   | 1054.99  |
|    10    |    0     |   100    |   1100   |   1025   | 1054.99  |
|    11    |    0     |   100    |   1100   |   1017   | 1054.99  |
|    12    |  13200   |  12100   |   1100   |   1008   | 1054.99  |
|  总利息  |   1200   |   1200   |   1200   |   650    |  659.89  |
|   APR    |   10%    |   10%    |   10%    |  5.42%   |   5.5%   |
|   IRR    |  9.57%   |   10%    |  17.97%  |   10%    |   10%    |

可以观察到，等额本息与等额本金的APR与IRR相差巨大。实际生活中，常会见到贷款产品的利率标的是$min(APR, IRR)$，需要分辨清楚。
